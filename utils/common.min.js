function waitForQuery(){const MaxRetry=30;let retry=0;const tryQuery=(query,condition,action,failed)=>{if(retry>=30)failed&&failed();else{const result=query();condition(result)?action(result):(retry++,setTimeout(()=>tryQuery(query,condition,action,failed),500))}};return tryQuery}function getStyle(key,settings){const style=GM_getResourceText(key),replaceCustomColor=(style,settings)=>{const foreground=(()=>{const regex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(settings.customStyleColor),color=regex?{r:parseInt(regex[1],16),g:parseInt(regex[2],16),b:parseInt(regex[3],16)}:void 0;if(color){const grey=1-(.299*color.r+.587*color.g+.114*color.b)/255;return grey<.35?"#000":"#fff"}return"#fff"})();for(key of(settings.foreground=foreground,settings.brightness=`${"#000"===foreground?"100":"0"}%`,settings.filterBrightness="#000"===foreground?"0":"100",Object.keys(settings)))style=style.replace(new RegExp("\\$"+key,"g"),settings[key]);return style};return replaceCustomColor(style,settings)}