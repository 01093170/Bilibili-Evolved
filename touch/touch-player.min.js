(()=>{return(i,t)=>{const e=(i,t)=>{return i.data("events")[t][0].handler};const s=i=>{let t=0;let e=0;while(i&&!isNaN(i.offsetLeft)&&!isNaN(i.offsetTop)){t+=i.offsetLeft-i.scrollLeft;e+=i.offsetTop-i.scrollTop;i=i.offsetParent}return{x:t,y:e}};const o=(i,t=1)=>{const e=i.toString();const s=e.indexOf(".");if(s!==-1){if(e.length-s>t+1){return e.substring(0,s+t+1)}else{return e}}else{return e+".0"}};const n=i=>{i=Math.abs(i);const t=Math.floor(i/3600);const e=Math.floor((i-t*3600)/60);const s=i-t*3600-e*60;let n=o(s)+"秒";if(e>0){n=e+"分"+n}if(t>0){n=t+"小时"+n}return n};const l=i=>{i=Math.abs(i);const t=Math.floor(i/3600);const e=Math.floor((i-t*3600)/60);const s=i-t*3600-e*60;let n=(s<10?"0":"")+o(s);n=(e<10?"0":"")+e+":"+n;n=(t<10?"0":"")+t+":"+n;return n};class a{constructor(i){this.action=new c(i);this.onTouchStart=null;this.onTouchEnd=null;this._direction=null;i.addEventListener("touchstart",i=>{this._xDown=i.touches[0].clientX;this._yDown=i.touches[0].clientY;if(this.onTouchStart){this.onTouchStart(i)}});i.addEventListener("touchmove",t=>{if(!this._xDown||!this._yDown){return}const e=t.touches[0].clientX;const o=t.touches[0].clientY;const n=s(i);const l={x:(t.touches[0].pageX-n.x)/i.clientWidth,y:(t.touches[0].pageY-n.y)/i.clientHeight,width:i.clientWidth,height:i.clientHeight};const a=this._xDown-e;const c=this._yDown-o;if(!this._direction){let i="";if(Math.abs(a)>Math.abs(c)){i="horizontal"}else{i="vertical"}this._direction=i;t.preventDefault()}else{if(this._direction==="vertical"){this.action.startAction(this._direction,c,l)}else if(this._direction==="horizontal"){this.action.startAction(this._direction,-a,l)}t.preventDefault()}});i.addEventListener("touchend",i=>{this._xDown=null;this._yDown=null;this._direction=null;if(this.onTouchEnd){this.onTouchEnd(i)}})}}class c{constructor(i){this.lowSpeedForward=null;this.lowSpeedBackward=null;this.mediumSpeedForward=null;this.mediumSpeedBackward=null;this.highSpeedForward=null;this.highSpeedBackward=null;this.lowVolumeUp=null;this.lowVolumeDown=null;this.mediumVolumeUp=null;this.mediumVolumeDown=null;this.highVolumeUp=null;this.highVolumeDown=null;this.speedCancel=null;this.volumeCancel=null;this.minSwipeDistance=20;this.onActionStart=null;this.onActionEnd=null;this._element=i;this._touchStart=false;this._startPosition=null;this._lastAction=null;i.addEventListener("touchstart",()=>{this._touchStart=true});i.addEventListener("touchend",()=>{this._startPosition=null;this.onActionEnd&&this.onActionEnd(this._lastAction);this._lastAction=null})}startAction(i,t,e){if(this._touchStart){this.onActionStart&&this.onActionStart();this._startPosition=e;this._touchStart=false}if(i==="vertical"){if(Math.abs(t)<this.minSwipeDistance){this.volumeCancel&&this.volumeCancel();this._lastAction=null}else{let i=0;let s=undefined;let o=undefined;if(this._startPosition.x<1/3){i=.4;s=this.lowVolumeUp;o=this.lowVolumeDown}else if(this._startPosition.x>=1/3&&this._startPosition.x<=2/3){i=1;s=this.mediumVolumeUp;o=this.mediumVolumeDown}else{i=2;s=this.highVolumeUp;o=this.highVolumeDown}if(t>0){const o=Math.round(i*100*(t-this.minSwipeDistance)/(1.5*e.height));s&&s(o);this._lastAction={type:"volume",volume:o}}else{const s=Math.round(i*100*(t+this.minSwipeDistance)/(1.5*e.height));o&&o(s);this._lastAction={type:"volume",volume:s}}}}else if(i==="horizontal"){if(e.y<1/3&&(e.x<.1||e.x>.9)||Math.abs(t)<this.minSwipeDistance){this.speedCancel&&this.speedCancel();this._lastAction=null}else{let i=0;let e=undefined;let s=undefined;if(this._startPosition.y<1/3){i=.05;e=this.lowSpeedForward;s=this.lowSpeedBackward}else if(this._startPosition.y>=1/3&&this._startPosition.y<=2/3){i=.2;e=this.mediumSpeedForward;s=this.mediumSpeedBackward}else{i=1;e=this.highSpeedForward;s=this.highSpeedBackward}if(t>0){const s=(t-this.minSwipeDistance)*i;e&&e(s);this._lastAction={type:"playback",seconds:s}}else{const e=(t+this.minSwipeDistance)*i;s&&s(e);this._lastAction={type:"playback",seconds:e}}}}}}SpinQuery.any(()=>$(".bilibili-player-video-web-fullscreen"),i=>{if(!i.hasClass("bilibili-player-video-btn")&&$(".bilibili-player-video-btn-fullscreen").data("events")){const t=e($(".bilibili-player-video-btn-fullscreen"),"click");i.detach().insertAfter(".bilibili-player-video-btn-widescreen").addClass("bilibili-player-video-btn").on("click",t)}});SpinQuery.any(()=>$(".bilibili-player-iconfont,.bilibili-player-video-quality-menu"),i=>i.unbind("click"));SpinQuery.count(()=>$(".bilibili-player-video,video"),2,i=>{if($(".touch-video-box").length===0){$(".bilibili-player-video-subtitle").before(`<div class='touch-video-box-wrapper'>\n                            <div class='touch-video-box'>\n                                <div class='touch-video-info'></div>\n                                <div class='touch-progress'></div>\n                            </div>\n                        </div>`);const t=$("video");const e=t.prop("duration");const s=new a(i.get(0));const c=document.getElementsByClassName("touch-video-info")[0];const h=document.getElementsByClassName("touch-video-box")[0];let r=Math.round(t.prop("volume")*100);const d=i=>{i/=100;if(i<0){i=0}else if(i>1){i=1}t.prop("volume",i);$(".bilibili-player-video-volume-num").text(Math.round(i*100));$(".bui-thumb").css("transform",`translateY(-${48*i}px)`);$(".bui-track-vertical .bui-bar").css("transform",`scaleY(${i})`);if(i===0){$(".bilibili-player-video-btn-volume").addClass(".video-state-volume-min");$(".bilibili-player-video-btn-volume").removeClass(".video-state-volume-max");t.prop("muted",true)}else if(i===1){$(".bilibili-player-video-btn-volume").removeClass(".video-state-volume-min");$(".bilibili-player-video-btn-volume").addClass(".video-state-volume-max");t.prop("muted",false)}else{$(".bilibili-player-video-btn-volume").removeClass(".video-state-volume-min");$(".bilibili-player-video-btn-volume").removeClass(".video-state-volume-max");t.prop("muted",false)}$(".bpui-slider-progress").css("height",i*100+"%");$(".bpui-slider-handle").css("bottom",(35+i*230)/3+"%");if(i===0){$(".icon-24soundoff").show();$(".icon-24soundlarge").hide();$(".icon-24soundsmall").hide()}else if(i>=.5){$(".icon-24soundoff").hide();$(".icon-24soundlarge").show();$(".icon-24soundsmall").hide()}else{$(".icon-24soundoff").hide();$(".icon-24soundlarge").hide();$(".icon-24soundsmall").show()}};s.action.onActionStart=(()=>{h.style.display="flex";c.innerHTML="";r=Math.round(t.prop("volume")*100)});const u=i=>{return s=>{const a=t.prop("currentTime");let h=`<div class='touch-row'><span class='touch-speed'>${i}速</span><span class='touch-info'>进度: ${s>0?"+":"-"}`;const r=`</span></div><div class='touch-row'><div class='videoshot'></div><span class='touch-result'>`;const d=a+s;let u="0%";if(d>e){u="100%";h+=`${n(e-a)}${r}${l(a)} → ${l(e)} (${u})`}else if(d<0){u="0%";h+=`${n(a)}${r}${l(a)} → ${l(0)} (${u})`}else{u=o(100*d/e)+"%";h+=`${n(s)}${r}${l(a)} → ${l(d)} (${u})`}c.innerHTML=h+`</span></div><div class='touch-progress'></div>`;$(".touch-progress").css("width",u)}};s.action.lowSpeedBackward=u("低");s.action.lowSpeedForward=u("低");s.action.mediumSpeedBackward=u("中");s.action.mediumSpeedForward=u("中");s.action.highSpeedBackward=u("高");s.action.highSpeedForward=u("高");const p=i=>{return t=>{let e=`<div class='touch-row'><span class='touch-speed'>${i}速</span><span class='touch-info'>音量: ${t>0?"+":"-"}`;const s=`</span></div><div class='touch-row'><span class='touch-result'>`;const o=r+t;if(o>100){e+=`${100-r}${s}${r} → 100`;d(100);$(".touch-progress").css("width","100%")}else if(o<0){e+=`${r}${s}${r} → 0`;d(0);$(".touch-progress").css("width","0%")}else{e+=`${Math.abs(t)}${s}${r} → ${o}`;d(o);$(".touch-progress").css("width",o+"%")}c.innerHTML=e+`</span></div><div class='touch-progress'></div>`}};s.action.lowVolumeUp=p("低");s.action.lowVolumeDown=p("低");s.action.mediumVolumeUp=p("中");s.action.mediumVolumeDown=p("中");s.action.highVolumeUp=p("高");s.action.highVolumeDown=p("高");s.action.speedCancel=(()=>{c.innerHTML=`松开手指,取消进退`});s.action.volumeCancel=(()=>{c.innerHTML=`松开手指,取消调整`;d(r)});s.action.onActionEnd=(i=>{h.style.display="none";c.innerHTML="";if(i){if(i.type==="playback"){let s=t.prop("currentTime");s+=i.seconds;if(s<0){s=0}else if(s>e){s=e}t.prop("currentTime",s)}}})}});t.applyStyle("touchPlayerStyle","bilibili-touch-video-player")}})();