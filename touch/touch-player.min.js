(()=>(t,i)=>{const o=t=>{let i=0,o=0;for(;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft-t.scrollLeft,o+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{x:i,y:o}};class e{constructor(t){this.action=new s(t),this.onTouchStart=void 0,this.onTouchEnd=void 0,this._direction=null,t.addEventListener("touchstart",t=>{this._xDown=t.touches[0].clientX,this._yDown=t.touches[0].clientY,this.onTouchStart&&this.onTouchStart(t)}),t.addEventListener("touchmove",i=>{if(!this._xDown||!this._yDown)return;const e=i.touches[0].clientX,s=i.touches[0].clientY,n=o(t),h={x:(i.touches[0].pageX-n.x)/t.clientWidth,y:(i.touches[0].pageY-n.y)/t.clientHeight,width:t.clientWidth,height:t.clientHeight},l=this._xDown-e,a=this._yDown-s;if(this._direction)"vertical"===this._direction?this.action.startAction(this._direction,a,h):"horizontal"===this._direction&&this.action.startAction(this._direction,-l,h),i.preventDefault();else{let t="";t=Math.abs(l)>Math.abs(a)?"horizontal":"vertical",this._direction=t,i.preventDefault()}}),t.addEventListener("touchend",t=>{this._xDown=null,this._yDown=null,this._direction=null,this.onTouchEnd&&this.onTouchEnd(t)})}}class s{constructor(t){this.lowSpeedForward=void 0,this.lowSpeedBackward=void 0,this.mediumSpeedForward=void 0,this.mediumSpeedBackward=void 0,this.highSpeedForward=void 0,this.highSpeedBackward=void 0,this.lowVolumeUp=void 0,this.lowVolumeDown=void 0,this.mediumVolumeUp=void 0,this.mediumVolumeDown=void 0,this.highVolumeUp=void 0,this.highVolumeDown=void 0,this.speedCancel=void 0,this.volumeCancel=void 0,this.minSwipeDistance=20,this.onActionStart=void 0,this.onActionEnd=void 0,this._element=t,this._touchStart=!1,this._startPosition=null,this._lastAction=null,t.addEventListener("touchstart",()=>{this._touchStart=!0}),t.addEventListener("touchend",()=>{this._startPosition=null,this.onActionEnd&&this.onActionEnd(this._lastAction),this._lastAction=null})}startAction(t,i,o){if(this._touchStart&&(this.onActionStart&&this.onActionStart(),this._startPosition=o,this._touchStart=!1),"vertical"===t)if(Math.abs(i)<this.minSwipeDistance)this.volumeCancel&&this.volumeCancel(),this._lastAction=null;else{let t=0,e=void 0,s=void 0;if(this._startPosition.x<1/3?(t=.4,e=this.lowVolumeUp,s=this.lowVolumeDown):this._startPosition.x>=1/3&&this._startPosition.x<=2/3?(t=1,e=this.mediumVolumeUp,s=this.mediumVolumeDown):(t=2,e=this.highVolumeUp,s=this.highVolumeDown),i>0){const s=Math.round(100*t*(i-this.minSwipeDistance)/(1.5*o.height));e&&e(s),this._lastAction={type:"volume",volume:s}}else{const e=Math.round(100*t*(i+this.minSwipeDistance)/(1.5*o.height));s&&s(e),this._lastAction={type:"volume",volume:e}}}else if("horizontal"===t)if(o.y<1/3&&(o.x<.1||o.x>.9)||Math.abs(i)<this.minSwipeDistance)this.speedCancel&&this.speedCancel(),this._lastAction=null;else{let t=0,o=void 0,e=void 0;if(this._startPosition.y<1/3?(t=.05,o=this.lowSpeedForward,e=this.lowSpeedBackward):this._startPosition.y>=1/3&&this._startPosition.y<=2/3?(t=.2,o=this.mediumSpeedForward,e=this.mediumSpeedBackward):(t=1,o=this.highSpeedForward,e=this.highSpeedBackward),i>0){const e=(i-this.minSwipeDistance)*t;o&&o(e),this._lastAction={type:"playback",seconds:e}}else{const o=(i+this.minSwipeDistance)*t;e&&e(o),this._lastAction={type:"playback",seconds:o}}}}}if(waitForQuery()(()=>$(".bilibili-player-iconfont,.bilibili-player-video-quality-menu"),t=>t.length>0,t=>t.unbind("click")),waitForQuery()(()=>$(".bilibili-player-video"),t=>t.length>0&&$("video").length>0,t=>{if(0===$(".touch-video-box").length){$(".bilibili-player-video-subtitle").before("<div class='touch-video-box-wrapper'>\n                            <div class='touch-video-box'>\n                                <div class='touch-video-info'></div>\n                            </div>\n                        </div>");const i=new e(t.get(0)),o=document.getElementsByClassName("touch-video-info")[0],s=document.getElementsByClassName("touch-video-box")[0];i.action.speedCancel=(()=>{o.innerHTML="松开手指,取消进退"}),i.action.volumeCancel=(()=>{o.innerHTML="松开手指,取消调整"}),i.action.onActionStart=(()=>{s.style.display="flex",o.innerHTML=""});const n=(t,i=1)=>{const o=t.toString(),e=o.indexOf(".");return-1!==e?o.length-e>i+1?o.substring(0,e+i+1):o:o+".0"},h=t=>{t=Math.abs(t);const i=Math.floor(t/3600),o=Math.floor((t-3600*i)/60),e=t-3600*i-60*o;let s=n(e)+"秒";return o>0&&(s=o+"分"+s),i>0&&(s=i+"小时"+s),s},l=t=>{t=Math.abs(t);const i=Math.floor(t/3600),o=Math.floor((t-3600*i)/60),e=t-3600*i-60*o;let s=(e<10?"0":"")+n(e);return s=(o<10?"0":"")+o+":"+s,s=(i<10?"0":"")+i+":"+s},a=$("video"),c=a.prop("duration"),d=t=>i=>{const e=a.prop("currentTime");let s=`<div class='touch-row'><span class='touch-speed'>${t}速</span><span class='touch-info'>进度: ${i>0?"+":"-"}`;const d="</span></div><div class='touch-row'><div class='videoshot'></div><span class='touch-result'>",r=e+i;s+=r>c?`${h(c-e)}${d}${l(e)} → ${l(c)} (100%)`:r<0?`${h(e)}${d}${l(e)} → ${l(0)} (0%)`:`${h(i)}${d}${l(e)} → ${l(r)} (${n(100*r/c)}%)`,o.innerHTML=s+"</span></div>"};i.action.lowSpeedBackward=d("低"),i.action.lowSpeedForward=d("低"),i.action.mediumSpeedBackward=d("中"),i.action.mediumSpeedForward=d("中"),i.action.highSpeedBackward=d("高"),i.action.highSpeedForward=d("高");const r=t=>i=>{const e=Math.round(100*a.prop("volume"));let s=`<div class='touch-row'><span class='touch-speed'>${t}速</span><span class='touch-info'>音量: ${i>0?"+":"-"}`;const n="</span></div><div class='touch-row'><span class='touch-result'>",h=e+i;s+=h>100?`${100-e}${n}${e} → 100`:h<0?`${e}${n}${e} → 0`:`${Math.abs(i)}${n}${e} → ${h}`,o.innerHTML=s+"</span></div>"};i.action.lowVolumeUp=r("低"),i.action.lowVolumeDown=r("低"),i.action.mediumVolumeUp=r("中"),i.action.mediumVolumeDown=r("中"),i.action.highVolumeUp=r("高"),i.action.highVolumeDown=r("高"),i.action.onActionEnd=(t=>{if(s.style.display="none",o.innerHTML="",t)if("volume"===t.type){let i=a.prop("volume");(i+=t.volume/100)<0?i=0:i>1&&(i=1),a.prop("volume",i),$(".bilibili-player-video-volume-num").text(Math.round(100*i)),$(".bpui-slider-progress").css("height",100*i+"%"),$(".bpui-slider-handle").css("bottom",(35+230*i)/3+"%"),0===i?($(".icon-24soundoff").show(),$(".icon-24soundlarge").hide(),$(".icon-24soundsmall").hide()):i>=.5?($(".icon-24soundoff").hide(),$(".icon-24soundlarge").show(),$(".icon-24soundsmall").hide()):($(".icon-24soundoff").hide(),$(".icon-24soundlarge").hide(),$(".icon-24soundsmall").show())}else if("playback"===t.type){let i=a.prop("currentTime");(i+=t.seconds)<0?i=0:i>c&&(i=c),a.prop("currentTime",i)}})}}),0===$("#bilibili-touch-video-player").length){const t=i.getStyle("touchPlayerStyle","bilibili-touch-video-player");$("body").after(t)}})();