(()=>{return(e,i)=>{if(isEmbeddedPlayer()){return}function t(e){const i=e.text();if(/第(\d+)话/.test(i)){e.parent().find(".bilibili-player-video-toast-item-jump").click();SpinQuery.condition(()=>document.querySelector(".bilibili-player-video video"),e=>e&&e.paused===true,e=>e.play());return}const t=/((\d)*:)?(\d)*:(\d)*/g;const n=i.match(t);if(!n){return}const r=n[0].split(":");const o=(()=>{if(r.length===3){const[e,i,t]=r.map(e=>parseInt(e));return e*60*60+i*60+t}else if(r.length===2){const[e,i]=r.map(e=>parseInt(e));return e*60+i}else{logError(`解析历史时间发生错误: historyTime=${JSON.stringify(r)}`);return NaN}})();const l=e.parent();const s=document.querySelector("video");if(o<s.duration){s.currentTime=o;s.play();l.find(".bilibili-player-video-toast-item-jump").remove();const i=$(`<div class="bilibili-player-video-toast-item-jump">从头开始</div>`);i.appendTo(l).on("click",()=>s.currentTime=0);e.html(`<span>已跳转到上次历史记录</span><span>${n[0]}</span>`)}else{l.find(".bilibili-player-video-toast-item-close").get(0).click()}}function n(){SpinQuery.condition(()=>$(".bilibili-player-video-toast-item-text"),e=>e.text().indexOf("上次看到")!==-1,e=>t(e.filter((e,i)=>i.innerText.indexOf("上次看到")!==-1)))}if(Observer.videoChange){Observer.videoChange(n)}else{Observer.childList("#bofqi",n)}}})();