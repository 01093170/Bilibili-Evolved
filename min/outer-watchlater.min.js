(()=>{return(t,i)=>{(async()=>{if(!document.URL.includes("//www.bilibili.com/video/av")){return}await SpinQuery.condition(()=>document.querySelector(".video-toolbar .ops .collect"),t=>{return t!==null&&t.innerText!=="--"});const t=document.cookie.replace(/(?:(?:^|.*;\s*)bili_jct\s*\=\s*([^;]*).*$)|^.*$/,"$1");const i=document.querySelector(".video-toolbar .ops .collect");if(!i){return}i.insertAdjacentHTML("afterend",`\n        <span title="稍后再看" class="watchlater">\n            <i class="mdi mdi-timetable"></i>\n            稍后再看\n        </span>\n    `);const e=document.querySelector(".ops .watchlater");if(!e){return}const s=await SpinQuery.select(()=>unsafeWindow.aid);const n=await Ajax.getJsonWithCredentials("https://api.bilibili.com/x/v2/history/toview/web");if(n.code!==0){n.data={list:[]}}const o=n.data.list.map(t=>t.aid);if(o.includes(parseInt(s))){e.classList.add("on")}e.addEventListener("click",()=>{e.classList.toggle("on");if(e.classList.contains("on")){Ajax.postTextWithCredentials("https://api.bilibili.com/x/v2/history/toview/add",`aid=${s}&csrf=${t}`)}else{Ajax.postTextWithCredentials("https://api.bilibili.com/x/v2/history/toview/del",`aid=${s}&csrf=${t}`)}})})()}})();