(()=>{return(e,i)=>{const n=[{name:"常规",action:()=>{}},{name:"宽屏",action:()=>{$(".bilibili-player-video-btn-widescreen").click()}},{name:"网页全屏",action:()=>{$(".bilibili-player-video-web-fullscreen").click()}}];SpinQuery.any(()=>$(".gui-settings-dropdown:has(input[key=defaultPlayerMode])"),e=>{const i=e.find("ul");const t=e.find("input");Object.values(n).forEach(e=>{$(`<li>${e.name}</li>`).appendTo(i).on("click",()=>{t.val(e.name).trigger("input").change()})})});let t=()=>{};function l(){if(e.autoLightOff){new SpinQuery(()=>$(""),()=>unsafeWindow.$&&unsafeWindow.$(".bilibili-player-video-btn-setting"),()=>unsafeWindow.$(".bilibili-player-video-btn-setting").mouseover().mouseout()).start();t=(()=>{SpinQuery.any(()=>$(".bilibili-player-video-btn-setting-panel-others-content-lightoff .bui-checkbox-input"),e=>{const i=e[0];const n=document.createEvent("HTMLEvents");n.initEvent("change",true,true);i.checked=true;i.dispatchEvent(n)})})}}function o(){l();new SpinQuery(()=>$(".bilibili-player-video,.bilibili-player-video-btn-start,.bilibili-player-area"),e=>e.length===3&&$("video").length>0&&$("video").prop("duration"),()=>{const i=document.querySelector("video");const l=n.find(i=>i.name===e.defaultPlayerMode);if(l.name==="全屏"){const e=document.querySelector(".bilibili-player-video-btn-start");const i=()=>{$(".bilibili-player-video-btn-fullscreen").click();e.removeEventListener("click",i)};e.addEventListener("click",i)}else{const e=()=>{if(l&&$("#bilibiliPlayer[class*=mode-]").length===0){l.action()}t();i.removeEventListener("play",e)};i.addEventListener("play",e)}}).start()}Observer.subtree("#bofqi",()=>o())}})();