(()=>{return(t,e)=>{(async()=>{if(!document.URL.startsWith("https://live.bilibili.com/")){return}const t=document.URL.match(/live\.bilibili\.com\/(\d+)/);if(!t){console.warn("roomID not found");return}const n=t[1];const s=await SpinQuery.select(".chat-history-list");if(s===null){console.warn("chatList not found");return}e.applyStyle("superchatTranslateStyle");const a=async()=>{const t=await Ajax.getJson(`https://api.live.bilibili.com/av/v1/SuperChat/getMessageList?room_id=${n}`);if(t.code!==0){console.warn(`superchat api failed with ${t.code}`);return[]}return _.get(t,"data.list",[])};Observer.childList(s,t=>{t.forEach(t=>{t.addedNodes.forEach(async t=>{if(t instanceof HTMLElement&&t.classList.contains("superChat-card-detail")){const e=t.getAttribute("data-ts");if(!e){console.warn("ts not found");return}const n=await a();const s=n.find(t=>t.ts.toString()===e);if(!s){console.warn("message not found");return}const i=s.message_jpn;const o=await SpinQuery.select(`.superChat-card-detail[data-ts='${e}'] .input-contain .text`);if(!o){console.warn("textElement not found");return}const r=document.createElement("span");r.classList.add("text");r.style.opacity=".5";r.innerText=i;o.insertAdjacentElement("afterend",r);console.log(`inserted translation: `,{ts:e,original:s.message,translation:i})}})})})})()}})();