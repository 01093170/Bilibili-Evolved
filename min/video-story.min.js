(()=>{return(t,i)=>{class e{constructor(t){this.title=t.option;this.nodeID=t.node_id;this.cid=t.cid;this.default=t.is_default===1}}class s{constructor(t,i){this.title=t.title;this.nodeID=t.node_id;this.aid=i;this.cid=t.cid;this.choices=[];this.choiceTime=-1}async getChoices(){if(this.choices.length>0){return}const t=`https://api.bilibili.com/x/stein/nodeinfo?aid=${this.aid}&node_id=${this.nodeID}&graph_version=504`;const i=await Ajax.getJson(t);if(i.code!==0){console.error(`获取选项失败: ${i.message}`);return}this.choices=i.data.edges.choices.map(t=>new e(t))}}class o{constructor(t,i){this.nodeList=t;if(i){this.startingNode=i}else{[this.startingNode]=t}}async getAllChoices(){return await Promise.all(this.nodeList.map(t=>t.getChoices()))}}const n=async t=>{const i=`https://api.bilibili.com/x/stein/nodeinfo?aid=${t}&graph_version=504`;const n=await Ajax.getJson(i);if(n.code!==0){return n.message}const c=n.data.story_list.map(i=>new s(i,t));const a=c.find(t=>t.nodeID===n.data.node_id);if(!a){return"获取起始结点失败"}a.choiceTime=n.data.edges.show_time;const d=n.data.edges.choices.map(t=>new e(t));a.choices=d;return new o(c,a)};return{export:{StoryChoice:e,StoryNode:s,Story:o,getStoryNodes:n}}}})();